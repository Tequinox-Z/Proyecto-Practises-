!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@stanvanheumen/ngx-storage"),require("rxjs/BehaviorSubject"),require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@stanvanheumen/ngx-storage","rxjs/BehaviorSubject","@angular/core","@angular/common"],e):e((t.stanvanheumen=t.stanvanheumen||{},t.stanvanheumen["ngx-translations"]={}),t.ngxStorage,t.Rx,t.ng.core,t.ng.common)}(this,function(t,e,a,n,r){"use strict";function u(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function i(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,a,o=n.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)i.push(r.value)}catch(u){a={error:u}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(a)throw a.error}}return i}var o=function(){this.production=!1,this.dictionary=[]},s=function(){function t(t,e){this.storage=t,this.config=e,this.storageToken="__NGX_CURRENT_LANGUAGE__",this.dictionary=[],this.defaultDictionary=[{languages:["en-US","en"],data:null,name:"English (English)"}],this.currentLanguage$=new a.BehaviorSubject(null),this.config||(this.config={production:!1,dictionary:[]}),this.dictionary=this.config.dictionary.concat(this.defaultDictionary),this.config.production||this.validate()||console.warn("The language files have been compared and they have not passed the validation.");var n=(this.storage?this.storage.get(this.storageToken):new a.BehaviorSubject(null)).getValue(),r=this.verify(n);this.use(r)}return t.prototype.use=function(t){this.isLanguageSupported(t)||(t=this.defaultDictionary[0].languages[0],console.warn("The language is not supported; The language has been set to '"+t+"'")),this.currentLanguage$.next(t),this.storage&&this.storage.set(this.storageToken,t)},t.prototype.instant=function(t){return this.translate(t)},t.prototype.translate=function(t){var r=this,e=this.getLanguageDictionary(this.currentLanguage$.getValue()),n="object"==typeof t?t.token:t,a="object"==typeof t?t.data:{},o=null;return e?e[n]?o=e[n]:(this.notify("Key '"+n+"' was not found; "+n+" was returned."),o=n):o=n,(o.match(/\${(.*?)}/g)||[]).forEach(function(t){var e=t.replace(/[${} ]/g,"").split("|");if(!(e.length<=0||2<e.length)){var n=e[0];if(a[n]&&(n=a[n],(1===e.length||e[1]&&-1===e[1].split(",").indexOf("keep"))&&(n=r.translate(n))),2===e.length)e[1].split(",").forEach(function(t){if("lowercase"===t)n=n.toLowerCase();else if("uppercase"===t)n=n.toUpperCase();else if("ucfirst"===t){var e=n.charAt(0).toUpperCase();n=e+n.substr(1)}});o=o.replace(t,n)}}),o},t.prototype.getLanguage=function(){return this.currentLanguage$.getValue()},t.prototype.getDictionary=function(){return this.dictionary},t.prototype.verify=function(t){if(null!==t&&this.isLanguageSupported(t))return t;var e=this.getBrowserLanguage();return this.isLanguageSupported(e)||(e=this.defaultDictionary[0].languages[0]),this.storage&&this.storage.set(this.storageToken,e),e},t.prototype.getBrowserLanguage=function(){var t=null;return navigator?t=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.userLanguage?navigator.userLanguage:navigator.language:t},t.prototype.getLanguageDictionary=function(t){try{for(var e=u(this.dictionary),n=e.next();!n.done;n=e.next()){var r=n.value;if(-1<r.languages.indexOf(t))return r.data}}catch(i){a={error:i}}finally{try{n&&!n.done&&(o=e["return"])&&o.call(e)}finally{if(a)throw a.error}}return null;var a,o},t.prototype.isLanguageSupported=function(t){try{for(var e=u(this.dictionary),n=e.next();!n.done;n=e.next()){if(-1<n.value.languages.indexOf(t))return!0}}catch(o){r={error:o}}finally{try{n&&!n.done&&(a=e["return"])&&a.call(e)}finally{if(r)throw r.error}}return!1;var r,a},t.prototype.validate=function(){var n=this,r=[];this.dictionary.forEach(function(t){if(t.data){var e=n.getKeys(t.data);r.push(e)}});var e=r[0]||[];return r.every(function(t){return n.compare(e,t)})},t.prototype.getKeys=function(n,r){var a=this;void 0===r&&(r=null);var o=[];return Object.keys(n).forEach(function(t){var e=n[t];"object"==typeof e?o.push.apply(o,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t}(a.getKeys(e,r?r+"."+t:t))):o.push(r?r+"."+t:t)}),o},t.prototype.compare=function(t,e){if(t===e)return!0;if(null===t||null===e)return!1;var n=!0;t.length!==e.length&&(console.warn("The files have been compared and not every file has the same length."),n=!1);for(var r=0;r<t.length;++r)t[r]!==e[r]&&(n=!1,console.warn("Line "+r+" did not equal the first language.json file; "+t[r]+" !== "+e[r]));return n},t.prototype.notify=function(t){if(!this.config||!this.config.production)throw new Error(t);console.warn(t)},t}();s.decorators=[{type:n.Injectable}],s.ctorParameters=function(){return[{type:e.StorageService},{type:o,decorators:[{type:n.Optional}]}]};var c=function(){function t(t){this.translate=t}return t.prototype.transform=function(t,e){if(void 0===e&&(e={}),!this.translate)return t;if(!t)return null;if("object"!=typeof e)throw new Error("The arguments were not formatted properly.");return"string"==typeof t&&(t={token:t,data:e}),this.translate.instant(t)},t}();c.decorators=[{type:n.Pipe,args:[{name:"translate"}]}],c.ctorParameters=function(){return[{type:s,decorators:[{type:n.Optional}]}]};var l=function(){function e(){}return e.forRoot=function(t){return void 0===t&&(t={production:!1,dictionary:[]}),{ngModule:e,providers:[{provide:o,useValue:t}]}},e}();l.decorators=[{type:n.NgModule,args:[{imports:[r.CommonModule,e.NgxStorageModule],providers:[s],declarations:[c],exports:[c]}]}],l.ctorParameters=function(){return[]},t.NgxTranslationsModule=l,t.TranslationsService=s,t.NgxTranslationsPipe=c,t.TranslationsConfig=o,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=stanvanheumen-ngx-translations.umd.min.js.map
